{{ 'component-slider.css' | asset_url | stylesheet_tag }}
{{ 'collection-showcase.css' | asset_url | stylesheet_tag }}

<section
  class="collection-grid section-{{ section.id }}"
  style="
    --arrow-color: {{ section.settings.arrow_color }};
    --arrow-bg: {{ section.settings.arrow_bg_color }};
  "
>
  {%- liquid
    assign columns_mobile_int = section.settings.columns_mobile | plus: 0
    assign columns_desktop_int = section.settings.columns_desktop | plus: 0

    assign collection_cards_count = 0
    for block in section.blocks
      if block.settings.collection != blank
        assign collection_cards_count = collection_cards_count | plus: 1
      endif
    endfor

    assign show_mobile_slider = false
    if section.settings.swipe_on_mobile and collection_cards_count > columns_mobile_int
      assign show_mobile_slider = true
    endif

    assign show_desktop_slider = false
    if section.settings.enable_desktop_slider and collection_cards_count > columns_desktop_int
      assign show_desktop_slider = true
    endif

    assign desktop_columns_static = columns_desktop_int
    if collection_cards_count > 0 and collection_cards_count < columns_desktop_int
      assign desktop_columns_static = collection_cards_count
    endif
  -%}

  <div class="collection-grid__inner page-width">
    {% if section.settings.heading != blank %}
      <h2 class="collection-grid__heading h1" style="color: {{ section.settings.heading_color }}">
        {{ section.settings.heading }}
      </h2>
    {% endif %}

    <slider-component class="collection-grid__slider-component slider-mobile-gutter">
      <ul
        id="Slider-{{ section.id }}"
        class="
          collection-grid__slider
          grid
          grid--{{ section.settings.columns_desktop }}-col-desktop
          grid--{{ section.settings.columns_mobile }}-col-tablet-down
          {% if show_mobile_slider or show_desktop_slider %} slider{% endif %}
          {% if show_mobile_slider %} slider--tablet grid--peek{% endif %}
          {% if show_desktop_slider %} slider--desktop{% endif %}
        "
        role="list"
        aria-label="{{ 'general.slider.name' | t }}"
        style="
          --desktop-columns: {{ columns_desktop_int }};
          --desktop-columns-static: {{ desktop_columns_static }};
          --mobile-columns: {{ columns_mobile_int }};
        "
      >
        {% for block in section.blocks %}
          {% assign collection = block.settings.collection %}
          {% if collection != blank %}
            <li
              id="Slide-{{ section.id }}-{{ forloop.index }}"
              class="grid__item{% if show_mobile_slider or show_desktop_slider %} slider__slide{% endif %}"
              {{ block.shopify_attributes }}
            >
              <div class="collection-card" style="
                  --card-bg: {{ block.settings.card_bg }};
                  --btn-bg: {{ block.settings.button_color }};
                  --btn-color: {{ block.settings.button_font_color }};
                  --card-radius: {{ section.settings.card_border_radius }}px;
                  --btn-radius: {{ section.settings.button_border_radius }}px;
                ">
                {% assign img = block.settings.custom_image | default: collection.featured_image %}
                {% assign ratio = 100 %}
                {% if img != blank and img.aspect_ratio > 0 %}
                  {% assign ratio = 1 | divided_by: img.aspect_ratio | times: 100 %}
                {% endif %}

                <div class="collection-card__image-wrapper" style="--ratio: {{ ratio }}%;">
                  {% if img != blank %}
                    {{ img | image_url: width: 800 | image_tag: loading: 'lazy', class: 'collection-card__image' }}
                  {% else %}
                    {{ 'collection-apparel-1' | placeholder_svg_tag: 'collection-card__image collection-card__image--placeholder' }}
                  {% endif %}
                </div>

                <div class="collection-card__content">
                  <h3 class="collection-card__title">
                    {{ block.settings.category | default: collection.title }}
                  </h3>

                  {% if block.settings.description != blank %}
                    <p class="collection-card__description">{{ block.settings.description }}</p>
                  {% endif %}

                  <a href="{{ collection.url }}" class="collection-card__button">
                    {{ section.settings.button_text }} &rarr;
                  </a>

                  {% if section.settings.show_product_count %}
                    <span class="collection-card__count">{{ collection.products_count }} Products</span>
                  {% endif %}
                </div>
              </div>
            </li>
          {% endif %}
        {% endfor %}
      </ul>

      {% if show_mobile_slider or show_desktop_slider %}
        <div class="slider-buttons">
          <button
            type="button"
            class="slider-button slider-button--prev"
            name="previous"
            aria-label="{{ 'general.slider.previous_slide' | t }}"
            aria-controls="Slider-{{ section.id }}"
          >
            <span class="svg-wrapper">
              {{- 'icon-caret.svg' | inline_asset_content -}}
            </span>
          </button>
          <button
            type="button"
            class="slider-button slider-button--next"
            name="next"
            aria-label="{{ 'general.slider.next_slide' | t }}"
            aria-controls="Slider-{{ section.id }}"
          >
            <span class="svg-wrapper">
              {{- 'icon-caret.svg' | inline_asset_content -}}
            </span>
          </button>
        </div>
      {% endif %}
    </slider-component>
  </div>
</section>

{% schema %}
  {
    "name": "Collection Showcase",
    "settings": [
      {
        "type": "inline_richtext",
        "id": "heading",
        "label": "Heading",
        "default": "Shop by Category"
      },
      {
        "type": "color",
        "id": "heading_color",
        "label": "Heading color",
        "default": "#121212"
      },
      {
        "type": "color",
        "id": "arrow_color",
        "label": "Arrow color",
        "default": "#1f1f1f"
      },
      {
        "type": "color",
        "id": "arrow_bg_color",
        "label": "Arrow background",
        "default": "#ffffff"
      },
      {
        "type": "range",
        "id": "card_border_radius",
        "min": 0,
        "max": 24,
        "step": 2,
        "unit": "px",
        "label": "Card border radius",
        "default": 12
      },
      {
        "type": "range",
        "id": "button_border_radius",
        "min": 0,
        "max": 24,
        "step": 2,
        "unit": "px",
        "label": "Button border radius",
        "default": 6
      },
      {
        "type": "inline_richtext",
        "id": "button_text",
        "label": "Button text",
        "default": "View All"
      },
      {
        "type": "checkbox",
        "id": "show_product_count",
        "label": "Show product count",
        "default": true
      },
      {
        "type": "select",
        "id": "columns_mobile",
        "label": "Mobile columns",
        "options": [
          {
            "value": "1",
            "label": "1"
          },
          {
            "value": "2",
            "label": "2"
          }
        ],
        "default": "1"
      },
      {
        "type": "range",
        "id": "columns_desktop",
        "min": 2,
        "max": 6,
        "step": 1,
        "default": 4,
        "label": "Desktop columns"
      },
      {
        "type": "checkbox",
        "id": "swipe_on_mobile",
        "default": true,
        "label": "Enable swipe on mobile"
      },
      {
        "type": "checkbox",
        "id": "enable_desktop_slider",
        "default": false,
        "label": "Enable desktop slider"
      }
    ],
    "blocks": [
      {
        "type": "collection_card",
        "name": "Collection Card",
        "settings": [
          {
            "type": "collection",
            "id": "collection",
            "label": "Collection"
          },
          {
            "type": "inline_richtext",
            "id": "category",
            "label": "Category Name"
          },
          {
            "type": "textarea",
            "id": "description",
            "label": "Description"
          },
          {
            "type": "image_picker",
            "id": "custom_image",
            "label": "Custom Image For Collection"
          },
          {
            "type": "color",
            "id": "card_bg",
            "label": "Card Background",
            "default": "#ffffff"
          },
          {
            "type": "color",
            "id": "button_color",
            "label": "Button Color",
            "default": "#dc3545"
          },
          {
            "type": "color",
            "id": "button_font_color",
            "label": "Button font color",
            "default": "#ffffff"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Collection Showcase",
        "blocks": [
          {
            "type": "collection_card"
          },
          {
            "type": "collection_card"
          },
          {
            "type": "collection_card"
          },
          {
            "type": "collection_card"
          }
        ]
      }
    ]
  }
{% endschema %}
